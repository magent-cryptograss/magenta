#!/bin/bash
# SSH routing script - routes connections to appropriate user containers

USER=$1

if [ -z "$USER" ]; then
    echo "Error: No user specified"
    exit 1
fi

CONTAINER="${USER}-arthel"

# Check if container exists and is running
if ! docker ps --format '{% raw %}{{.Names}}{% endraw %}' | grep -q "^${CONTAINER}$"; then
    echo "Error: Container ${CONTAINER} not found or not running"
    exit 1
fi

# If SSH_ORIGINAL_COMMAND is set, execute it in the container
# Otherwise, start an interactive shell
if [ -n "$SSH_ORIGINAL_COMMAND" ]; then
    docker exec -i "$CONTAINER" su - magent -c "$SSH_ORIGINAL_COMMAND"
else
    docker exec -it "$CONTAINER" su - magent
fi
