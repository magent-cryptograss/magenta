---
- name: Start shared services (MCP server, Memory Lane, Watcher)
  command: docker compose -f docker-compose.services.yml up -d --build --force-recreate
  args:
    chdir: "{{ base_dir }}/magenta-source"
  environment:
    POSTGRES_PASSWORD: "{{ postgres_password }}"

- name: Verify services are running
  command: docker ps --filter "name={{ item }}" --format "{% raw %}{{.Names}}{% endraw %}"
  register: service_check
  failed_when: "item not in service_check.stdout"
  loop:
    - mcp-server
    - memory-lane
    - watcher
